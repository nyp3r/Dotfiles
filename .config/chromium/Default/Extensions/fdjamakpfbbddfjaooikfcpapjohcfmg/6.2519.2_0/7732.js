"use strict";(globalThis.webpackChunk_dashlane_leeloo=globalThis.webpackChunk_dashlane_leeloo||[]).push([[7732],{79739:(e,t,a)=>{a.r(t),a.d(t,{CredentialAddPanel:()=>x});var s,n=a(51031),o=a(18108),i=a(30894),l=a(96832),r=a(26849),c=a(73704),u=a(62264),d=a(30309),m=a(78346),p=a(8180),g=a(46525),w=a(14877),h=a(86342),S=a(39431),I=a(83459),f=a(13252),L=a(88203),P=a(45272),U=a(8403),y=a(92077),C=a(42670),E=a(19122),b=a(63520),v=a(63144),A=a(99975),k=a(27089),V=a(36351);const _=()=>{const{translate:e}=(0,L.Z)();return(0,V.tZ)(b.V9,{icon:s||(s=(0,V.tZ)(k.E,{size:"xlarge",forceFallback:!0,domainURL:""})),title:e("webapp_credential_addition_website")})};var D,R=a(50094);const q=["name","website"],N={name:"itemName",website:"URL"},T=({activeSpaces:e,onClose:t,protectedItemsUnlockerShown:a,openProtectedItemsUnlocker:s,areProtectedItemsUnlocked:n})=>{var o,i;const k=(0,l.createRef)(),[T,x]=(0,l.useState)(!1),{routes:Z}=(0,y.Xo)(),{currentSpaceId:M}=(0,E.fV)(),{showToast:O}=(0,u.p)(),{translate:B}=(0,L.Z)(),X=(0,U.v0)(),z=!X.isLoading&&X.shouldShowAtOrOverLimitContent,{openDialog:F,shouldShowFrozenStateDialog:H}=(0,C.Ub)(),{createCollection:G,updateCollection:J}=(0,p.u)(g.v),{addItemsToCollections:K}=(0,p.u)(I.a),{createVaultItem:W}=(0,p.u)(w.L),{updateCredentialPreferences:Y}=(0,p.u)(R.I),[j,Q]=(0,l.useState)(!1),[$,ee]=(0,l.useState)(!1),te=(0,y.TH)(),ae=(0,l.useRef)(te.state?.previouslyGeneratedPassword),[se,ne]=(0,l.useState)(Boolean(ae.current)),[oe,ie]=(0,l.useState)(!1),le=(()=>{const e=(0,y.CN)();return q.reduce(((t,a)=>(t[N[a]||a]=e.get(a),t)),{})})(),re={alternativeUsername:"",email:"",itemName:"",linkedURLs:[],note:"",otpURL:"",password:null!=(o=ae.current)?o:"",spaceId:e.length>0&&!e[0].info?.personalSpaceEnabled?e[0].teamId:null!=M?M:"",username:"",...le,URL:null!=(i=te.state?.website)?i:le.URL,onlyAutofillExactDomain:!1,requireMasterPassword:!1,useAutoLogin:!0},[ce,ue]=(0,l.useState)(re);(0,l.useEffect)((()=>{const{onlyAutofillExactDomain:e,requireMasterPassword:t,useAutoLogin:a,...s}=ce,{onlyAutofillExactDomain:n,requireMasterPassword:o,useAutoLogin:i,...l}=re,c=!(0,r.equals)(ce,re)&&!z;ne(c),ie(!(0,r.equals)(s,l))}),[ce]);const de=()=>{Q(!0)};(0,l.useEffect)((()=>{z&&de(),H&&(F(),t())}),[z,H]),(0,l.useEffect)((()=>{(0,P.Nc)(c.PageView.ItemCredentialCreate)}),[]);const me=()=>O({description:B("_common_generic_error"),mood:"danger"}),pe=()=>{(0,P.Nc)(c.PageView.ItemCredentialList),j?(0,y.uX)(Z.userCredentials):t?t():(0,y.uX)(Z.userCredentials)};return X.isLoading||null===H?null:(0,V.BX)(b.zI,{isUsingNewDesign:!0,isViewingExistingItem:!1,isSomeDialogOpen:$,itemHasBeenEdited:se,onSubmit:async()=>{Boolean(k.current?.isFormValid())&&(x(!0),await(async()=>{const e=k.current?.getVaultItemCollections(),{onlyAutofillExactDomain:t,useAutoLogin:a,requireMasterPassword:s,...n}=ce,o=t!==re.onlyAutofillExactDomain||a!==re.useAutoLogin||s!==re.requireMasterPassword;try{const i=await W({vaultItemType:S.U.Credential,content:n,shouldSkipSync:!!o});if(!(0,m.d6)(i))return void me();const l=(0,m.db)(i).id,r=[];o&&r.push(Y({credentialId:l,credentialUrl:n.URL,onlyAutofillExactDomain:t,useAutoLogin:a,requireMasterPassword:s,shouldSkipSync:e?.some((e=>e.isShared))})),e?.length&&r.push((async(e,t)=>{const a=[];for(const n of t){var s;n.isShared?a.push({collectionId:n.id,permission:null!=(s=n.itemPermission)?s:f.y3.Limited}):(n.vaultItems=[{id:e,type:d.dJ.KWAuthentifiant,url:ce.URL}],n.id?await J({id:n.id,collection:n,operationType:h.C.APPEND_VAULT_ITEMS}):await G({content:n}))}a.length&&await K({collectionPermissions:a,itemIds:[e]})})(l,e)),await Promise.all(r)}catch(e){me()}})(),z?de():pe())},onNavigateOut:pe,formId:"add_credential_panel",header:D||(D=(0,V.tZ)(_,{})),submitPending:T,children:[(0,V.tZ)(v.S,{ref:k,editableValues:ce,setEditableValues:ue,readonlyValues:{id:"",canEdit:!0,canReveal:!0,canCopy:!0,linkedURLs:[]},isNewItem:!0,signalEditedValues:()=>ne(!0),activeSpaces:e,areProtectedItemsUnlocked:n,openProtectedItemsUnlocker:s,protectedItemsUnlockerShown:a,setHasOpenedDialogs:ee}),j&&(0,V.tZ)(A.e,{isVisible:j,handleDismiss:pe})]})},x=e=>{const t=(0,o.E)(),a=(0,i.tY)();return t.status!==n.rq.Success?null:(0,V.tZ)(T,{...e,activeSpaces:t.data,...a})}}}]);